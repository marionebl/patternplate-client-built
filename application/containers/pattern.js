'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});

var _slicedToArray2 = require('babel-runtime/helpers/slicedToArray');

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _toConsumableArray2 = require('babel-runtime/helpers/toConsumableArray');

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _entries = require('babel-runtime/core-js/object/entries');

var _entries2 = _interopRequireDefault(_entries);

var _values = require('babel-runtime/core-js/object/values');

var _values2 = _interopRequireDefault(_values);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _lodash = require('lodash');

var _reactRedux = require('react-redux');

var _redux = require('redux');

var _shortid = require('shortid');

var _shortid2 = _interopRequireDefault(_shortid);

var _urlQuery = require('../utils/url-query');

var _urlQuery2 = _interopRequireDefault(_urlQuery);

var _navigate = require('../utils/navigate');

var _navigate2 = _interopRequireDefault(_navigate);

var _pattern = require('../components/pattern');

var _pattern2 = _interopRequireDefault(_pattern);

var _actions = require('../actions');

var _patternDemoError = require('../actions/pattern-demo-error');

var _patternDemoError2 = _interopRequireDefault(_patternDemoError);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = (0, _reactRedux.connect)(mapState, mapDispatch)(_pattern2.default);


function mapState(state) {
	return {
		activeSource: state.sourceId || '',
		automount: selectAutomount(state),
		base: state.base,
		breadcrumbs: selectBreadCrumbs(state),
		code: selectCode(state),
		rulerX: selectRulerXFraction(state),
		rulerY: selectRulerYFraction(state),
		rulerLengthX: selectRulerLengthX(state),
		rulerLengthY: selectRulerLengthY(state),
		demoContentHeight: selectDemoContentHeight(state),
		demoContentWidth: selectDemoContentWidth(state),
		demoHeight: selectHeight(state),
		demoWidth: selectWidth(state),
		dependencies: selectDependencies(state),
		dependents: selectDependents(state),
		display: selectDisplay(state),
		environment: state.environment,
		environments: selectEnvironments(state),
		errored: selectPatternErrored(state),
		flag: selectFlag(state),
		id: selectId(state),
		loading: selectLoading(state),
		location: selectLocation(state),
		name: selectName(state),
		onDemoReady: selectOnDemoReloaded(state),
		opacity: state.opacity,
		reloadedTime: selectReloadedTime(state),
		reloadTime: selectReloadTime(state),
		rulers: state.rulers,
		sourceExpanded: state.sourceExpanded,
		tags: selectTags(state),
		version: selectVersion(state)
	};
}

function mapDispatch(dispatch) {
	return (0, _redux.bindActionCreators)({
		onConcernChange: _actions.changeConcern,
		onDemoError: _patternDemoError2.default,
		onDemoReady: function onDemoReady() {
			return (0, _actions.loadPatternDemo)(false);
		},
		onDemoContentResize: _actions.demoContentResize,
		onDemoScroll: _actions.scrollDemo,
		onEnvironmentChange: _actions.changeEnvironment,
		onFileRequest: _actions.loadPatternFile,
		reload: _actions.loadPattern,
		resize: _actions.resizeDemo,
		onTypeChange: _actions.changeType
	}, dispatch);
}

function selectWidth(state) {
	var dim = state.demoDimensions[state.id] || {};
	return isNaN(dim.x) ? selectWindowWidth(state) / 2 : dim.x;
}

function selectHeight(state) {
	var dim = state.demoDimensions[state.id] || {};
	return isNaN(dim.y) ? selectWindowHeight(state) / 2 : dim.y;
}

function selectDemoContentWidth(state) {
	var dim = state.demoContentDimensions[state.id] || {};
	return dim.width || 0;
}

function selectDemoContentHeight(state) {
	var dim = state.demoContentDimensions[state.id] || {};
	return dim.height || 0;
}

function selectRulerXFraction(state) {
	var length = selectRulerLengthX(state);
	var scrollX = state.scrollDemoX.x;
	return scrollX / (length / 100);
}

function selectRulerYFraction(state) {
	var length = selectRulerLengthY(state);
	var scrollY = state.scrollDemoY.y;
	return scrollY / (length / 100);
}

function selectRulerLengthX(state) {
	var width = selectDemoContentWidth(state);
	var windowWidth = selectWindowWidth(state);
	return width * 2 + Math.abs(windowWidth - width);
}

function selectRulerLengthY(state) {
	var height = selectDemoContentHeight(state);
	var windowHeight = selectWindowHeight(state);
	return height * 2 + Math.abs(windowHeight - height);
}

function selectWindowWidth(state) {
	return (state.window || {}).width || 0;
}

function selectWindowHeight(state) {
	return (state.window || {}).height || 0;
}

function selectBreadCrumbs(state) {
	var fragments = selectId(state).split('/');
	var location = selectLocation(state);

	if (fragments.length < 2) {
		return [];
	}

	return fragments.map(function (fragment, index) {
		var partial = fragments.slice(0, index + 1).join('/');
		return {
			id: partial,
			name: fragment,
			navigateable: index < fragments.length - 1,
			target: {
				pathname: state.base + 'pattern/' + partial,
				query: location.query
			}
		};
	});
}

function selectPattern(state) {
	var cached = (0, _navigate2.default)(state.id, state.navigation);
	return (0, _lodash.merge)({}, cached, state.pattern);
}

function selectManifest(state) {
	var pattern = selectPattern(state);
	return pattern.manifest || {};
}

function selectManifestOptions(state) {
	var manifest = selectManifest(state);
	return manifest.options || {};
}

function selectReactMarkup(state) {
	var options = selectManifestOptions(state);
	return options['react-to-markup'] || {};
}

function selectReactMarkupOptions(state) {
	var markup = selectReactMarkup(state);
	return markup.opts || {};
}

function selectAutomount(state) {
	var opts = selectReactMarkupOptions(state);
	return 'automount' in opts ? opts.automount : false;
}

function getManifestSelector(name, defaultValue) {
	return function (state) {
		var manifest = selectManifest(state);
		var value = manifest[name];
		return typeof value === 'undefined' ? defaultValue : value;
	};
}

function selectId(state) {
	return state.id || selectPattern(state).id;
}

function selectName(state) {
	var pattern = selectPattern(state);
	var name = getManifestSelector('name')(state);
	var displayName = getManifestSelector('displayName')(state);
	return displayName || name || pattern.id || '';
}

function selectEnvironments(state) {
	var environments = selectPattern(state).environments || [];
	return environments.map(function (env) {
		return {
			id: env.name,
			name: env.displayName || env.name
		};
	});
}

function selectFlag(state) {
	return getManifestSelector('flag', '')(state);
}

function selectTags(state) {
	return getManifestSelector('tags', [])(state);
}

function selectVersion(state) {
	return getManifestSelector('version', '')(state);
}

function selectDisplay(state) {
	return getManifestSelector('display', true)(state);
}

function selectDependentPatterns(state) {
	return selectPattern(state).dependents || {};
}

function selectDependents(state) {
	return (0, _values2.default)(selectDependentPatterns(state)).filter(function (pattern) {
		return pattern.display;
	}).reduce(function (registry, pattern) {
		var navPattern = (0, _navigate2.default)(pattern.id, state.navigation) || { manifest: {} };
		var patternEntries = (0, _entries2.default)(navPattern.manifest.patterns || {});
		var localNames = patternEntries.filter(function (entry) {
			return entry[1] === state.id;
		}).map(function (entry) {
			return entry[0];
		});

		var amend = localNames.map(function (localName) {
			return {
				id: pattern.id,
				name: pattern.displayName || pattern.name,
				localName: localName,
				version: pattern.version
			};
		});

		return [].concat((0, _toConsumableArray3.default)(registry), (0, _toConsumableArray3.default)(amend));
	}, []);
}

function selectDependencies(state) {
	var rootPattern = selectPattern(state);
	return (0, _entries2.default)(rootPattern.dependencies || {}).filter(function (entry) {
		return entry[0] !== 'Pattern';
	}).filter(function (entry) {
		return entry[1].manifest.display;
	}).map(function (entry) {
		var _entry = (0, _slicedToArray3.default)(entry, 2),
		    localName = _entry[0],
		    pattern = _entry[1];

		var navPattern = (0, _navigate2.default)(pattern.id, state.navigation) || { manifest: {} };

		return {
			id: pattern.id,
			name: navPattern.manifest.displayName || navPattern.manifest.name,
			localName: localName,
			version: navPattern.manifest.version
		};
	});
}

function selectLoading(state) {
	var pattern = selectPattern(state);
	return [pattern.dataLoading, pattern.demoLoading, pattern.sourceLoading].some(Boolean);
}

function selectReloadTime(state) {
	var pattern = selectPattern(state);
	return pattern.reloadTime || null;
}

function selectReloadedTime(state) {
	var pattern = selectPattern(state);
	return pattern.reloadedTime || null;
}

function selectLocation(state) {
	return state.routing.locationBeforeTransitions;
}

function selectOnDemoReloaded(state) {
	var pattern = selectPattern(state);
	return pattern.onDemoReloaded || _lodash.noop;
}

function selectPatternErrors(state) {
	return selectPattern(state).errors || [];
}

function selectPatternErrored(state) {
	var pattern = selectPattern(state);
	return [pattern.dataErrored, pattern.demoErrored, pattern.sourceErrored].some(Boolean);
}

function selectCode(state) {
	var pattern = selectPattern(state);
	var sources = pattern.sources || {};
	var files = pattern.files || [];
	var errors = selectPatternErrors(state);

	var formats = (0, _lodash.uniqBy)(files.reduce(function (registry, file) {
		return [].concat((0, _toConsumableArray3.default)(registry), [{
			id: [pattern.id, file.type].join('/'),
			displayName: file.displayName,
			inExtname: _path2.default.extname(file.path),
			outExtname: '.' + file.out,
			type: file.type,
			in: file.in,
			out: file.out
		}]);
	}, []), 'id');

	return formats.map(function (format) {
		var formatFiles = files.filter(function (file) {
			return file.type === format.type;
		});
		var concerns = formatFiles.map(function (file) {
			return file.concern;
		});

		var hasDemo = concerns.includes('demo');
		var defaultConcern = hasDemo ? 'demo' : 'index';
		var parsed = _urlQuery2.default.parse(state.sourceId || '');

		var passedConcern = _path2.default.basename(parsed.pathname, _path2.default.extname(parsed.pathname)) || defaultConcern;

		var isApplicable = concerns.includes(passedConcern);

		var concern = isApplicable ? passedConcern : defaultConcern;

		var sourceType = format.type === 'documentation' ? 'source' : state.sourceType;
		var language = sourceType === 'source' ? format.in : format.out;
		var extname = format.inExtname;
		var pathname = [pattern.id, '' + concern + extname].join('/');
		var types = hasDemo && concern === 'index' ? ['source'] : ['source', 'transformed'];
		var type = hasDemo && concern === 'index' ? 'source' : sourceType;

		var id = _urlQuery2.default.format({
			pathname: pathname,
			query: {
				type: type,
				environment: state.environment
			}
		});

		var source = sources[id];
		var active = state.sourceId === id;

		var fileErrors = errors.filter(function (error) {
			return error.payload ? error.payload.id === id : error.patternFile === id;
		});

		var update = active && !source && !pattern.sourceLoading && !fileErrors.length;

		return {
			active: active,
			update: update,
			extname: extname,
			concern: concern,
			concerns: concerns,
			id: id,
			shortid: (0, _shortid2.default)(id),
			language: language,
			name: format.displayName,
			source: source || '',
			type: type,
			types: types
		};
	});
}
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NvdXJjZS9hcHBsaWNhdGlvbi9jb250YWluZXJzL3BhdHRlcm4uanMiXSwibmFtZXMiOlsibWFwU3RhdGUiLCJtYXBEaXNwYXRjaCIsInN0YXRlIiwiYWN0aXZlU291cmNlIiwic291cmNlSWQiLCJhdXRvbW91bnQiLCJzZWxlY3RBdXRvbW91bnQiLCJiYXNlIiwiYnJlYWRjcnVtYnMiLCJzZWxlY3RCcmVhZENydW1icyIsImNvZGUiLCJzZWxlY3RDb2RlIiwicnVsZXJYIiwic2VsZWN0UnVsZXJYRnJhY3Rpb24iLCJydWxlclkiLCJzZWxlY3RSdWxlcllGcmFjdGlvbiIsInJ1bGVyTGVuZ3RoWCIsInNlbGVjdFJ1bGVyTGVuZ3RoWCIsInJ1bGVyTGVuZ3RoWSIsInNlbGVjdFJ1bGVyTGVuZ3RoWSIsImRlbW9Db250ZW50SGVpZ2h0Iiwic2VsZWN0RGVtb0NvbnRlbnRIZWlnaHQiLCJkZW1vQ29udGVudFdpZHRoIiwic2VsZWN0RGVtb0NvbnRlbnRXaWR0aCIsImRlbW9IZWlnaHQiLCJzZWxlY3RIZWlnaHQiLCJkZW1vV2lkdGgiLCJzZWxlY3RXaWR0aCIsImRlcGVuZGVuY2llcyIsInNlbGVjdERlcGVuZGVuY2llcyIsImRlcGVuZGVudHMiLCJzZWxlY3REZXBlbmRlbnRzIiwiZGlzcGxheSIsInNlbGVjdERpc3BsYXkiLCJlbnZpcm9ubWVudCIsImVudmlyb25tZW50cyIsInNlbGVjdEVudmlyb25tZW50cyIsImVycm9yZWQiLCJzZWxlY3RQYXR0ZXJuRXJyb3JlZCIsImZsYWciLCJzZWxlY3RGbGFnIiwiaWQiLCJzZWxlY3RJZCIsImxvYWRpbmciLCJzZWxlY3RMb2FkaW5nIiwibG9jYXRpb24iLCJzZWxlY3RMb2NhdGlvbiIsIm5hbWUiLCJzZWxlY3ROYW1lIiwib25EZW1vUmVhZHkiLCJzZWxlY3RPbkRlbW9SZWxvYWRlZCIsIm9wYWNpdHkiLCJyZWxvYWRlZFRpbWUiLCJzZWxlY3RSZWxvYWRlZFRpbWUiLCJyZWxvYWRUaW1lIiwic2VsZWN0UmVsb2FkVGltZSIsInJ1bGVycyIsInNvdXJjZUV4cGFuZGVkIiwidGFncyIsInNlbGVjdFRhZ3MiLCJ2ZXJzaW9uIiwic2VsZWN0VmVyc2lvbiIsImRpc3BhdGNoIiwib25Db25jZXJuQ2hhbmdlIiwib25EZW1vRXJyb3IiLCJvbkRlbW9Db250ZW50UmVzaXplIiwib25EZW1vU2Nyb2xsIiwib25FbnZpcm9ubWVudENoYW5nZSIsIm9uRmlsZVJlcXVlc3QiLCJyZWxvYWQiLCJyZXNpemUiLCJvblR5cGVDaGFuZ2UiLCJkaW0iLCJkZW1vRGltZW5zaW9ucyIsImlzTmFOIiwieCIsInNlbGVjdFdpbmRvd1dpZHRoIiwieSIsInNlbGVjdFdpbmRvd0hlaWdodCIsImRlbW9Db250ZW50RGltZW5zaW9ucyIsIndpZHRoIiwiaGVpZ2h0IiwibGVuZ3RoIiwic2Nyb2xsWCIsInNjcm9sbERlbW9YIiwic2Nyb2xsWSIsInNjcm9sbERlbW9ZIiwid2luZG93V2lkdGgiLCJNYXRoIiwiYWJzIiwid2luZG93SGVpZ2h0Iiwid2luZG93IiwiZnJhZ21lbnRzIiwic3BsaXQiLCJtYXAiLCJmcmFnbWVudCIsImluZGV4IiwicGFydGlhbCIsInNsaWNlIiwiam9pbiIsIm5hdmlnYXRlYWJsZSIsInRhcmdldCIsInBhdGhuYW1lIiwicXVlcnkiLCJzZWxlY3RQYXR0ZXJuIiwiY2FjaGVkIiwibmF2aWdhdGlvbiIsInBhdHRlcm4iLCJzZWxlY3RNYW5pZmVzdCIsIm1hbmlmZXN0Iiwic2VsZWN0TWFuaWZlc3RPcHRpb25zIiwib3B0aW9ucyIsInNlbGVjdFJlYWN0TWFya3VwIiwic2VsZWN0UmVhY3RNYXJrdXBPcHRpb25zIiwibWFya3VwIiwib3B0cyIsImdldE1hbmlmZXN0U2VsZWN0b3IiLCJkZWZhdWx0VmFsdWUiLCJ2YWx1ZSIsImRpc3BsYXlOYW1lIiwiZW52Iiwic2VsZWN0RGVwZW5kZW50UGF0dGVybnMiLCJmaWx0ZXIiLCJyZWR1Y2UiLCJyZWdpc3RyeSIsIm5hdlBhdHRlcm4iLCJwYXR0ZXJuRW50cmllcyIsInBhdHRlcm5zIiwibG9jYWxOYW1lcyIsImVudHJ5IiwiYW1lbmQiLCJsb2NhbE5hbWUiLCJyb290UGF0dGVybiIsImRhdGFMb2FkaW5nIiwiZGVtb0xvYWRpbmciLCJzb3VyY2VMb2FkaW5nIiwic29tZSIsIkJvb2xlYW4iLCJyb3V0aW5nIiwibG9jYXRpb25CZWZvcmVUcmFuc2l0aW9ucyIsIm9uRGVtb1JlbG9hZGVkIiwic2VsZWN0UGF0dGVybkVycm9ycyIsImVycm9ycyIsImRhdGFFcnJvcmVkIiwiZGVtb0Vycm9yZWQiLCJzb3VyY2VFcnJvcmVkIiwic291cmNlcyIsImZpbGVzIiwiZm9ybWF0cyIsImZpbGUiLCJ0eXBlIiwiaW5FeHRuYW1lIiwiZXh0bmFtZSIsInBhdGgiLCJvdXRFeHRuYW1lIiwib3V0IiwiaW4iLCJmb3JtYXRGaWxlcyIsImZvcm1hdCIsImNvbmNlcm5zIiwiY29uY2VybiIsImhhc0RlbW8iLCJpbmNsdWRlcyIsImRlZmF1bHRDb25jZXJuIiwicGFyc2VkIiwicGFyc2UiLCJwYXNzZWRDb25jZXJuIiwiYmFzZW5hbWUiLCJpc0FwcGxpY2FibGUiLCJzb3VyY2VUeXBlIiwibGFuZ3VhZ2UiLCJ0eXBlcyIsInNvdXJjZSIsImFjdGl2ZSIsImZpbGVFcnJvcnMiLCJlcnJvciIsInBheWxvYWQiLCJwYXR0ZXJuRmlsZSIsInVwZGF0ZSIsInNob3J0aWQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7OztBQUVBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRUE7Ozs7QUFDQTs7OztBQUNBOzs7O0FBRUE7O0FBS0E7Ozs7OztrQkFFZSx5QkFBUUEsUUFBUixFQUFrQkMsV0FBbEIsb0I7OztBQUVmLFNBQVNELFFBQVQsQ0FBa0JFLEtBQWxCLEVBQXlCO0FBQ3hCLFFBQU87QUFDTkMsZ0JBQWNELE1BQU1FLFFBQU4sSUFBa0IsRUFEMUI7QUFFTkMsYUFBV0MsZ0JBQWdCSixLQUFoQixDQUZMO0FBR05LLFFBQU1MLE1BQU1LLElBSE47QUFJTkMsZUFB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QUFELENBQWpDLEdBQThDLENBQUMsUUFBRCxFQUFXLGFBQVgsQ0FBNUQ7QUFDQSxNQUFNVixPQUFPVyxXQUFXRCxZQUFZLE9BQXZCLEdBQWlDLFFBQWpDLEdBQTRDUyxVQUF6RDs7QUFFQSxNQUFNaEksS0FBSyxtQkFBU3FILE1BQVQsQ0FBZ0I7QUFDMUJ4RCxxQkFEMEI7QUFFMUJDLFVBQU87QUFDTitDLGNBRE07QUFFTnBILGlCQUFhaEMsTUFBTWdDO0FBRmI7QUFGbUIsR0FBaEIsQ0FBWDs7QUFRQSxNQUFNMEksU0FBUzFCLFFBQVF6RyxFQUFSLENBQWY7QUFDQSxNQUFNb0ksU0FBUzNLLE1BQU1FLFFBQU4sS0FBbUJxQyxFQUFsQzs7QUFFQSxNQUFNcUksYUFBYWhDLE9BQU9wQixNQUFQLENBQWMsaUJBQVM7QUFDekMsVUFBT3FELE1BQU1DLE9BQU4sR0FDTkQsTUFBTUMsT0FBTixDQUFjdkksRUFBZCxLQUFxQkEsRUFEZixHQUVOc0ksTUFBTUUsV0FBTixLQUFzQnhJLEVBRnZCO0FBR0EsR0FKa0IsQ0FBbkI7O0FBTUEsTUFBTXlJLFNBQVNMLFVBQ2QsQ0FBQ0QsTUFEYSxJQUVkLENBQUNqRSxRQUFRNEIsYUFGSyxJQUdkLENBQUN1QyxXQUFXNUYsTUFIYjs7QUFLQSxTQUFPO0FBQ04yRixpQkFETTtBQUVOSyxpQkFGTTtBQUdOMUIsbUJBSE07QUFJTlEsbUJBSk07QUFLTkQscUJBTE07QUFNTnRILFNBTk07QUFPTjBJLFlBQVMsdUJBQVExSSxFQUFSLENBUEg7QUFRTmlJLHFCQVJNO0FBU04zSCxTQUFNK0csT0FBT3ZDLFdBVFA7QUFVTnFELFdBQVFBLFVBQVUsRUFWWjtBQVdOdEIsYUFYTTtBQVlOcUI7QUFaTSxHQUFQO0FBY0EsRUE1RE0sQ0FBUDtBQTZEQSIsImZpbGUiOiJwYXR0ZXJuLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5cbmltcG9ydCB7bWVyZ2UsIG5vb3AsIHVuaXFCeX0gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7Y29ubmVjdH0gZnJvbSAncmVhY3QtcmVkdXgnO1xuaW1wb3J0IHtiaW5kQWN0aW9uQ3JlYXRvcnN9IGZyb20gJ3JlZHV4JztcbmltcG9ydCBzaG9ydGlkIGZyb20gJ3Nob3J0aWQnO1xuXG5pbXBvcnQgdXJsUXVlcnkgZnJvbSAnLi4vdXRpbHMvdXJsLXF1ZXJ5JztcbmltcG9ydCBuYXZpZ2F0ZSBmcm9tICcuLi91dGlscy9uYXZpZ2F0ZSc7XG5pbXBvcnQgUGF0dGVybiBmcm9tICcuLi9jb21wb25lbnRzL3BhdHRlcm4nO1xuXG5pbXBvcnQge1xuXHRjaGFuZ2VDb25jZXJuLCBjaGFuZ2VFbnZpcm9ubWVudCwgY2hhbmdlVHlwZSwgZGVtb0NvbnRlbnRSZXNpemUsXG5cdGxvYWRQYXR0ZXJuLCBsb2FkUGF0dGVybkRlbW8sIGxvYWRQYXR0ZXJuRmlsZSwgcmVzaXplRGVtbywgc2Nyb2xsRGVtb1xufSBmcm9tICcuLi9hY3Rpb25zJztcblxuaW1wb3J0IHBhdHRlcm5EZW1vRXJyb3IgZnJvbSAnLi4vYWN0aW9ucy9wYXR0ZXJuLWRlbW8tZXJyb3InO1xuXG5leHBvcnQgZGVmYXVsdCBjb25uZWN0KG1hcFN0YXRlLCBtYXBEaXNwYXRjaCkoUGF0dGVybik7XG5cbmZ1bmN0aW9uIG1hcFN0YXRlKHN0YXRlKSB7XG5cdHJldHVybiB7XG5cdFx0YWN0aXZlU291cmNlOiBzdGF0ZS5zb3VyY2VJZCB8fCAnJyxcblx0XHRhdXRvbW91bnQ6IHNlbGVjdEF1dG9tb3VudChzdGF0ZSksXG5cdFx0YmFzZTogc3RhdGUuYmFzZSxcblx0XHRicmVhZGNydW1iczogc2VsZWN0QnJlYWRDcnVtYnMoc3RhdGUpLFxuXHRcdGNvZGU6IHNlbGVjdENvZGUoc3RhdGUpLFxuXHRcdHJ1bGVyWDogc2VsZWN0UnVsZXJYRnJhY3Rpb24oc3RhdGUpLFxuXHRcdHJ1bGVyWTogc2VsZWN0UnVsZXJZRnJhY3Rpb24oc3RhdGUpLFxuXHRcdHJ1bGVyTGVuZ3RoWDogc2VsZWN0UnVsZXJMZW5ndGhYKHN0YXRlKSxcblx0XHRydWxlckxlbmd0aFk6IHNlbGVjdFJ1bGVyTGVuZ3RoWShzdGF0ZSksXG5cdFx0ZGVtb0NvbnRlbnRIZWlnaHQ6IHNlbGVjdERlbW9Db250ZW50SGVpZ2h0KHN0YXRlKSxcblx0XHRkZW1vQ29udGVudFdpZHRoOiBzZWxlY3REZW1vQ29udGVudFdpZHRoKHN0YXRlKSxcblx0XHRkZW1vSGVpZ2h0OiBzZWxlY3RIZWlnaHQoc3RhdGUpLFxuXHRcdGRlbW9XaWR0aDogc2VsZWN0V2lkdGgoc3RhdGUpLFxuXHRcdGRlcGVuZGVuY2llczogc2VsZWN0RGVwZW5kZW5jaWVzKHN0YXRlKSxcblx0XHRkZXBlbmRlbnRzOiBzZWxlY3REZXBlbmRlbnRzKHN0YXRlKSxcblx0XHRkaXNwbGF5OiBzZWxlY3REaXNwbGF5KHN0YXRlKSxcblx0XHRlbnZpcm9ubWVudDogc3RhdGUuZW52aXJvbm1lbnQsXG5cdFx0ZW52aXJvbm1lbnRzOiBzZWxlY3RFbnZpcm9ubWVudHMoc3RhdGUpLFxuXHRcdGVycm9yZWQ6IHNlbGVjdFBhdHRlcm5FcnJvcmVkKHN0YXRlKSxcblx0XHRmbGFnOiBzZWxlY3RGbGFnKHN0YXRlKSxcblx0XHRpZDogc2VsZWN0SWQoc3RhdGUpLFxuXHRcdGxvYWRpbmc6IHNlbGVjdExvYWRpbmcoc3RhdGUpLFxuXHRcdGxvY2F0aW9uOiBzZWxlY3RMb2NhdGlvbihzdGF0ZSksXG5cdFx0bmFtZTogc2VsZWN0TmFtZShzdGF0ZSksXG5cdFx0b25EZW1vUmVhZHk6IHNlbGVjdE9uRGVtb1JlbG9hZGVkKHN0YXRlKSxcblx0XHRvcGFjaXR5OiBzdGF0ZS5vcGFjaXR5LFxuXHRcdHJlbG9hZGVkVGltZTogc2VsZWN0UmVsb2FkZWRUaW1lKHN0YXRlKSxcblx0XHRyZWxvYWRUaW1lOiBzZWxlY3RSZWxvYWRUaW1lKHN0YXRlKSxcblx0XHRydWxlcnM6IHN0YXRlLnJ1bGVycyxcblx0XHRzb3VyY2VFeHBhbmRlZDogc3RhdGUuc291cmNlRXhwYW5kZWQsXG5cdFx0dGFnczogc2VsZWN0VGFncyhzdGF0ZSksXG5cdFx0dmVyc2lvbjogc2VsZWN0VmVyc2lvbihzdGF0ZSlcblx0fTtcbn1cblxuZnVuY3Rpb24gbWFwRGlzcGF0Y2goZGlzcGF0Y2gpIHtcblx0cmV0dXJuIGJpbmRBY3Rpb25DcmVhdG9ycyh7XG5cdFx0b25Db25jZXJuQ2hhbmdlOiBjaGFuZ2VDb25jZXJuLFxuXHRcdG9uRGVtb0Vycm9yOiBwYXR0ZXJuRGVtb0Vycm9yLFxuXHRcdG9uRGVtb1JlYWR5OiAoKSA9PiBsb2FkUGF0dGVybkRlbW8oZmFsc2UpLFxuXHRcdG9uRGVtb0NvbnRlbnRSZXNpemU6IGRlbW9Db250ZW50UmVzaXplLFxuXHRcdG9uRGVtb1Njcm9sbDogc2Nyb2xsRGVtbyxcblx0XHRvbkVudmlyb25tZW50Q2hhbmdlOiBjaGFuZ2VFbnZpcm9ubWVudCxcblx0XHRvbkZpbGVSZXF1ZXN0OiBsb2FkUGF0dGVybkZpbGUsXG5cdFx0cmVsb2FkOiBsb2FkUGF0dGVybixcblx0XHRyZXNpemU6IHJlc2l6ZURlbW8sXG5cdFx0b25UeXBlQ2hhbmdlOiBjaGFuZ2VUeXBlXG5cdH0sIGRpc3BhdGNoKTtcbn1cblxuZnVuY3Rpb24gc2VsZWN0V2lkdGgoc3RhdGUpIHtcblx0Y29uc3QgZGltID0gc3RhdGUuZGVtb0RpbWVuc2lvbnNbc3RhdGUuaWRdIHx8IHt9O1xuXHRyZXR1cm4gaXNOYU4oZGltLngpID9cblx0XHRzZWxlY3RXaW5kb3dXaWR0aChzdGF0ZSkgLyAyIDpcblx0XHRkaW0ueDtcbn1cblxuZnVuY3Rpb24gc2VsZWN0SGVpZ2h0KHN0YXRlKSB7XG5cdGNvbnN0IGRpbSA9IHN0YXRlLmRlbW9EaW1lbnNpb25zW3N0YXRlLmlkXSB8fCB7fTtcblx0cmV0dXJuIGlzTmFOKGRpbS55KSA/XG5cdFx0c2VsZWN0V2luZG93SGVpZ2h0KHN0YXRlKSAvIDIgOlxuXHRcdGRpbS55O1xufVxuXG5mdW5jdGlvbiBzZWxlY3REZW1vQ29udGVudFdpZHRoKHN0YXRlKSB7XG5cdGNvbnN0IGRpbSA9IHN0YXRlLmRlbW9Db250ZW50RGltZW5zaW9uc1tzdGF0ZS5pZF0gfHwge307XG5cdHJldHVybiBkaW0ud2lkdGggfHwgMDtcbn1cblxuZnVuY3Rpb24gc2VsZWN0RGVtb0NvbnRlbnRIZWlnaHQoc3RhdGUpIHtcblx0Y29uc3QgZGltID0gc3RhdGUuZGVtb0NvbnRlbnREaW1lbnNpb25zW3N0YXRlLmlkXSB8fCB7fTtcblx0cmV0dXJuIGRpbS5oZWlnaHQgfHwgMDtcbn1cblxuZnVuY3Rpb24gc2VsZWN0UnVsZXJYRnJhY3Rpb24oc3RhdGUpIHtcblx0Y29uc3QgbGVuZ3RoID0gc2VsZWN0UnVsZXJMZW5ndGhYKHN0YXRlKTtcblx0Y29uc3Qgc2Nyb2xsWCA9IHN0YXRlLnNjcm9sbERlbW9YLng7XG5cdHJldHVybiBzY3JvbGxYIC8gKGxlbmd0aCAvIDEwMCk7XG59XG5cbmZ1bmN0aW9uIHNlbGVjdFJ1bGVyWUZyYWN0aW9uKHN0YXRlKSB7XG5cdGNvbnN0IGxlbmd0aCA9IHNlbGVjdFJ1bGVyTGVuZ3RoWShzdGF0ZSk7XG5cdGNvbnN0IHNjcm9sbFkgPSBzdGF0ZS5zY3JvbGxEZW1vWS55O1xuXHRyZXR1cm4gc2Nyb2xsWSAvIChsZW5ndGggLyAxMDApO1xufVxuXG5mdW5jdGlvbiBzZWxlY3RSdWxlckxlbmd0aFgoc3RhdGUpIHtcblx0Y29uc3Qgd2lkdGggPSBzZWxlY3REZW1vQ29udGVudFdpZHRoKHN0YXRlKTtcblx0Y29uc3Qgd2luZG93V2lkdGggPSBzZWxlY3RXaW5kb3dXaWR0aChzdGF0ZSk7XG5cdHJldHVybiB3aWR0aCAqIDIgKyBNYXRoLmFicyh3aW5kb3dXaWR0aCAtIHdpZHRoKTtcbn1cblxuZnVuY3Rpb24gc2VsZWN0UnVsZXJMZW5ndGhZKHN0YXRlKSB7XG5cdGNvbnN0IGhlaWdodCA9IHNlbGVjdERlbW9Db250ZW50SGVpZ2h0KHN0YXRlKTtcblx0Y29uc3Qgd2luZG93SGVpZ2h0ID0gc2VsZWN0V2luZG93SGVpZ2h0KHN0YXRlKTtcblx0cmV0dXJuIGhlaWdodCAqIDIgKyBNYXRoLmFicyh3aW5kb3dIZWlnaHQgLSBoZWlnaHQpO1xufVxuXG5mdW5jdGlvbiBzZWxlY3RXaW5kb3dXaWR0aChzdGF0ZSkge1xuXHRyZXR1cm4gKHN0YXRlLndpbmRvdyB8fCB7fSkud2lkdGggfHwgMDtcbn1cblxuZnVuY3Rpb24gc2VsZWN0V2luZG93SGVpZ2h0KHN0YXRlKSB7XG5cdHJldHVybiAoc3RhdGUud2luZG93IHx8IHt9KS5oZWlnaHQgfHwgMDtcbn1cblxuZnVuY3Rpb24gc2VsZWN0QnJlYWRDcnVtYnMoc3RhdGUpIHtcblx0Y29uc3QgZnJhZ21lbnRzID0gc2VsZWN0SWQoc3RhdGUpLnNwbGl0KCcvJyk7XG5cdGNvbnN0IGxvY2F0aW9uID0gc2VsZWN0TG9jYXRpb24oc3RhdGUpO1xuXG5cdGlmIChmcmFnbWVudHMubGVuZ3RoIDwgMikge1xuXHRcdHJldHVybiBbXTtcblx0fVxuXG5cdHJldHVybiBmcmFnbWVudHMubWFwKChmcmFnbWVudCwgaW5kZXgpID0+IHtcblx0XHRjb25zdCBwYXJ0aWFsID0gZnJhZ21lbnRzLnNsaWNlKDAsIGluZGV4ICsgMSkuam9pbignLycpO1xuXHRcdHJldHVybiB7XG5cdFx0XHRpZDogcGFydGlhbCxcblx0XHRcdG5hbWU6IGZyYWdtZW50LFxuXHRcdFx0bmF2aWdhdGVhYmxlOiBpbmRleCA8IGZyYWdtZW50cy5sZW5ndGggLSAxLFxuXHRcdFx0dGFyZ2V0OiB7XG5cdFx0XHRcdHBhdGhuYW1lOiBgJHtzdGF0ZS5iYXNlfXBhdHRlcm4vJHtwYXJ0aWFsfWAsXG5cdFx0XHRcdHF1ZXJ5OiBsb2NhdGlvbi5xdWVyeVxuXHRcdFx0fVxuXHRcdH07XG5cdH0pO1xufVxuXG5mdW5jdGlvbiBzZWxlY3RQYXR0ZXJuKHN0YXRlKSB7XG5cdGNvbnN0IGNhY2hlZCA9IG5hdmlnYXRlKHN0YXRlLmlkLCBzdGF0ZS5uYXZpZ2F0aW9uKTtcblx0cmV0dXJuIG1lcmdlKHt9LCBjYWNoZWQsIHN0YXRlLnBhdHRlcm4pO1xufVxuXG5mdW5jdGlvbiBzZWxlY3RNYW5pZmVzdChzdGF0ZSkge1xuXHRjb25zdCBwYXR0ZXJuID0gc2VsZWN0UGF0dGVybihzdGF0ZSk7XG5cdHJldHVybiBwYXR0ZXJuLm1hbmlmZXN0IHx8IHt9O1xufVxuXG5mdW5jdGlvbiBzZWxlY3RNYW5pZmVzdE9wdGlvbnMoc3RhdGUpIHtcblx0Y29uc3QgbWFuaWZlc3QgPSBzZWxlY3RNYW5pZmVzdChzdGF0ZSk7XG5cdHJldHVybiBtYW5pZmVzdC5vcHRpb25zIHx8IHt9O1xufVxuXG5mdW5jdGlvbiBzZWxlY3RSZWFjdE1hcmt1cChzdGF0ZSkge1xuXHRjb25zdCBvcHRpb25zID0gc2VsZWN0TWFuaWZlc3RPcHRpb25zKHN0YXRlKTtcblx0cmV0dXJuIG9wdGlvbnNbJ3JlYWN0LXRvLW1hcmt1cCddIHx8IHt9O1xufVxuXG5mdW5jdGlvbiBzZWxlY3RSZWFjdE1hcmt1cE9wdGlvbnMoc3RhdGUpIHtcblx0Y29uc3QgbWFya3VwID0gc2VsZWN0UmVhY3RNYXJrdXAoc3RhdGUpO1xuXHRyZXR1cm4gbWFya3VwLm9wdHMgfHwge307XG59XG5cbmZ1bmN0aW9uIHNlbGVjdEF1dG9tb3VudChzdGF0ZSkge1xuXHRjb25zdCBvcHRzID0gc2VsZWN0UmVhY3RNYXJrdXBPcHRpb25zKHN0YXRlKTtcblx0cmV0dXJuICgnYXV0b21vdW50JyBpbiBvcHRzKSA/IG9wdHMuYXV0b21vdW50IDogZmFsc2U7XG59XG5cbmZ1bmN0aW9uIGdldE1hbmlmZXN0U2VsZWN0b3IobmFtZSwgZGVmYXVsdFZhbHVlKSB7XG5cdHJldHVybiBzdGF0ZSA9PiB7XG5cdFx0Y29uc3QgbWFuaWZlc3QgPSBzZWxlY3RNYW5pZmVzdChzdGF0ZSk7XG5cdFx0Y29uc3QgdmFsdWUgPSBtYW5pZmVzdFtuYW1lXTtcblx0XHRyZXR1cm4gdHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJyA/IGRlZmF1bHRWYWx1ZSA6IHZhbHVlO1xuXHR9O1xufVxuXG5mdW5jdGlvbiBzZWxlY3RJZChzdGF0ZSkge1xuXHRyZXR1cm4gc3RhdGUuaWQgfHwgc2VsZWN0UGF0dGVybihzdGF0ZSkuaWQ7XG59XG5cbmZ1bmN0aW9uIHNlbGVjdE5hbWUoc3RhdGUpIHtcblx0Y29uc3QgcGF0dGVybiA9IHNlbGVjdFBhdHRlcm4oc3RhdGUpO1xuXHRjb25zdCBuYW1lID0gZ2V0TWFuaWZlc3RTZWxlY3RvcignbmFtZScpKHN0YXRlKTtcblx0Y29uc3QgZGlzcGxheU5hbWUgPSBnZXRNYW5pZmVzdFNlbGVjdG9yKCdkaXNwbGF5TmFtZScpKHN0YXRlKTtcblx0cmV0dXJuIGRpc3BsYXlOYW1lIHx8IG5hbWUgfHwgcGF0dGVybi5pZCB8fCAnJztcbn1cblxuZnVuY3Rpb24gc2VsZWN0RW52aXJvbm1lbnRzKHN0YXRlKSB7XG5cdGNvbnN0IGVudmlyb25tZW50cyA9IHNlbGVjdFBhdHRlcm4oc3RhdGUpLmVudmlyb25tZW50cyB8fCBbXTtcblx0cmV0dXJuIGVudmlyb25tZW50cy5tYXAoZW52ID0+IHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0aWQ6IGVudi5uYW1lLFxuXHRcdFx0bmFtZTogZW52LmRpc3BsYXlOYW1lIHx8IGVudi5uYW1lXG5cdFx0fTtcblx0fSk7XG59XG5cbmZ1bmN0aW9uIHNlbGVjdEZsYWcoc3RhdGUpIHtcblx0cmV0dXJuIGdldE1hbmlmZXN0U2VsZWN0b3IoJ2ZsYWcnLCAnJykoc3RhdGUpO1xufVxuXG5mdW5jdGlvbiBzZWxlY3RUYWdzKHN0YXRlKSB7XG5cdHJldHVybiBnZXRNYW5pZmVzdFNlbGVjdG9yKCd0YWdzJywgW10pKHN0YXRlKTtcbn1cblxuZnVuY3Rpb24gc2VsZWN0VmVyc2lvbihzdGF0ZSkge1xuXHRyZXR1cm4gZ2V0TWFuaWZlc3RTZWxlY3RvcigndmVyc2lvbicsICcnKShzdGF0ZSk7XG59XG5cbmZ1bmN0aW9uIHNlbGVjdERpc3BsYXkoc3RhdGUpIHtcblx0cmV0dXJuIGdldE1hbmlmZXN0U2VsZWN0b3IoJ2Rpc3BsYXknLCB0cnVlKShzdGF0ZSk7XG59XG5cbmZ1bmN0aW9uIHNlbGVjdERlcGVuZGVudFBhdHRlcm5zKHN0YXRlKSB7XG5cdHJldHVybiBzZWxlY3RQYXR0ZXJuKHN0YXRlKS5kZXBlbmRlbnRzIHx8IHt9O1xufVxuXG5mdW5jdGlvbiBzZWxlY3REZXBlbmRlbnRzKHN0YXRlKSB7XG5cdHJldHVybiBPYmplY3QudmFsdWVzKHNlbGVjdERlcGVuZGVudFBhdHRlcm5zKHN0YXRlKSlcblx0XHQuZmlsdGVyKHBhdHRlcm4gPT4gcGF0dGVybi5kaXNwbGF5KVxuXHRcdC5yZWR1Y2UoKHJlZ2lzdHJ5LCBwYXR0ZXJuKSA9PiB7XG5cdFx0XHRjb25zdCBuYXZQYXR0ZXJuID0gbmF2aWdhdGUocGF0dGVybi5pZCwgc3RhdGUubmF2aWdhdGlvbikgfHwge21hbmlmZXN0OiB7fX07XG5cdFx0XHRjb25zdCBwYXR0ZXJuRW50cmllcyA9IE9iamVjdC5lbnRyaWVzKG5hdlBhdHRlcm4ubWFuaWZlc3QucGF0dGVybnMgfHwge30pO1xuXHRcdFx0Y29uc3QgbG9jYWxOYW1lcyA9IHBhdHRlcm5FbnRyaWVzXG5cdFx0XHRcdC5maWx0ZXIoZW50cnkgPT4gZW50cnlbMV0gPT09IHN0YXRlLmlkKVxuXHRcdFx0XHQubWFwKGVudHJ5ID0+IGVudHJ5WzBdKTtcblxuXHRcdFx0Y29uc3QgYW1lbmQgPSBsb2NhbE5hbWVzLm1hcChsb2NhbE5hbWUgPT4ge1xuXHRcdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRcdGlkOiBwYXR0ZXJuLmlkLFxuXHRcdFx0XHRcdG5hbWU6IHBhdHRlcm4uZGlzcGxheU5hbWUgfHwgcGF0dGVybi5uYW1lLFxuXHRcdFx0XHRcdGxvY2FsTmFtZSxcblx0XHRcdFx0XHR2ZXJzaW9uOiBwYXR0ZXJuLnZlcnNpb25cblx0XHRcdFx0fTtcblx0XHRcdH0pO1xuXG5cdFx0XHRyZXR1cm4gWy4uLnJlZ2lzdHJ5LCAuLi5hbWVuZF07XG5cdFx0fSwgW10pO1xufVxuXG5mdW5jdGlvbiBzZWxlY3REZXBlbmRlbmNpZXMoc3RhdGUpIHtcblx0Y29uc3Qgcm9vdFBhdHRlcm4gPSBzZWxlY3RQYXR0ZXJuKHN0YXRlKTtcblx0cmV0dXJuIE9iamVjdC5lbnRyaWVzKHJvb3RQYXR0ZXJuLmRlcGVuZGVuY2llcyB8fCB7fSlcblx0XHQuZmlsdGVyKGVudHJ5ID0+IGVudHJ5WzBdICE9PSAnUGF0dGVybicpXG5cdFx0LmZpbHRlcihlbnRyeSA9PiBlbnRyeVsxXS5tYW5pZmVzdC5kaXNwbGF5KVxuXHRcdC5tYXAoZW50cnkgPT4ge1xuXHRcdFx0Y29uc3QgW2xvY2FsTmFtZSwgcGF0dGVybl0gPSBlbnRyeTtcblx0XHRcdGNvbnN0IG5hdlBhdHRlcm4gPSBuYXZpZ2F0ZShwYXR0ZXJuLmlkLCBzdGF0ZS5uYXZpZ2F0aW9uKSB8fCB7bWFuaWZlc3Q6IHt9fTtcblxuXHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0aWQ6IHBhdHRlcm4uaWQsXG5cdFx0XHRcdG5hbWU6IG5hdlBhdHRlcm4ubWFuaWZlc3QuZGlzcGxheU5hbWUgfHwgbmF2UGF0dGVybi5tYW5pZmVzdC5uYW1lLFxuXHRcdFx0XHRsb2NhbE5hbWUsXG5cdFx0XHRcdHZlcnNpb246IG5hdlBhdHRlcm4ubWFuaWZlc3QudmVyc2lvblxuXHRcdFx0fTtcblx0XHR9KTtcbn1cblxuZnVuY3Rpb24gc2VsZWN0TG9hZGluZyhzdGF0ZSkge1xuXHRjb25zdCBwYXR0ZXJuID0gc2VsZWN0UGF0dGVybihzdGF0ZSk7XG5cdHJldHVybiBbXG5cdFx0cGF0dGVybi5kYXRhTG9hZGluZyxcblx0XHRwYXR0ZXJuLmRlbW9Mb2FkaW5nLFxuXHRcdHBhdHRlcm4uc291cmNlTG9hZGluZ1xuXHRdLnNvbWUoQm9vbGVhbik7XG59XG5cbmZ1bmN0aW9uIHNlbGVjdFJlbG9hZFRpbWUoc3RhdGUpIHtcblx0Y29uc3QgcGF0dGVybiA9IHNlbGVjdFBhdHRlcm4oc3RhdGUpO1xuXHRyZXR1cm4gcGF0dGVybi5yZWxvYWRUaW1lIHx8IG51bGw7XG59XG5cbmZ1bmN0aW9uIHNlbGVjdFJlbG9hZGVkVGltZShzdGF0ZSkge1xuXHRjb25zdCBwYXR0ZXJuID0gc2VsZWN0UGF0dGVybihzdGF0ZSk7XG5cdHJldHVybiBwYXR0ZXJuLnJlbG9hZGVkVGltZSB8fCBudWxsO1xufVxuXG5mdW5jdGlvbiBzZWxlY3RMb2NhdGlvbihzdGF0ZSkge1xuXHRyZXR1cm4gc3RhdGUucm91dGluZy5sb2NhdGlvbkJlZm9yZVRyYW5zaXRpb25zO1xufVxuXG5mdW5jdGlvbiBzZWxlY3RPbkRlbW9SZWxvYWRlZChzdGF0ZSkge1xuXHRjb25zdCBwYXR0ZXJuID0gc2VsZWN0UGF0dGVybihzdGF0ZSk7XG5cdHJldHVybiBwYXR0ZXJuLm9uRGVtb1JlbG9hZGVkIHx8IG5vb3A7XG59XG5cbmZ1bmN0aW9uIHNlbGVjdFBhdHRlcm5FcnJvcnMoc3RhdGUpIHtcblx0cmV0dXJuIHNlbGVjdFBhdHRlcm4oc3RhdGUpLmVycm9ycyB8fCBbXTtcbn1cblxuZnVuY3Rpb24gc2VsZWN0UGF0dGVybkVycm9yZWQoc3RhdGUpIHtcblx0Y29uc3QgcGF0dGVybiA9IHNlbGVjdFBhdHRlcm4oc3RhdGUpO1xuXHRyZXR1cm4gW1xuXHRcdHBhdHRlcm4uZGF0YUVycm9yZWQsXG5cdFx0cGF0dGVybi5kZW1vRXJyb3JlZCxcblx0XHRwYXR0ZXJuLnNvdXJjZUVycm9yZWRcblx0XS5zb21lKEJvb2xlYW4pO1xufVxuXG5mdW5jdGlvbiBzZWxlY3RDb2RlKHN0YXRlKSB7XG5cdGNvbnN0IHBhdHRlcm4gPSBzZWxlY3RQYXR0ZXJuKHN0YXRlKTtcblx0Y29uc3Qgc291cmNlcyA9IHBhdHRlcm4uc291cmNlcyB8fCB7fTtcblx0Y29uc3QgZmlsZXMgPSBwYXR0ZXJuLmZpbGVzIHx8IFtdO1xuXHRjb25zdCBlcnJvcnMgPSBzZWxlY3RQYXR0ZXJuRXJyb3JzKHN0YXRlKTtcblxuXHRjb25zdCBmb3JtYXRzID0gdW5pcUJ5KGZpbGVzLnJlZHVjZSgocmVnaXN0cnksIGZpbGUpID0+IHtcblx0XHRyZXR1cm4gWy4uLnJlZ2lzdHJ5LCB7XG5cdFx0XHRpZDogW3BhdHRlcm4uaWQsIGZpbGUudHlwZV0uam9pbignLycpLFxuXHRcdFx0ZGlzcGxheU5hbWU6IGZpbGUuZGlzcGxheU5hbWUsXG5cdFx0XHRpbkV4dG5hbWU6IHBhdGguZXh0bmFtZShmaWxlLnBhdGgpLFxuXHRcdFx0b3V0RXh0bmFtZTogYC4ke2ZpbGUub3V0fWAsXG5cdFx0XHR0eXBlOiBmaWxlLnR5cGUsXG5cdFx0XHRpbjogZmlsZS5pbixcblx0XHRcdG91dDogZmlsZS5vdXRcblx0XHR9XTtcblx0fSwgW10pLCAnaWQnKTtcblxuXHRyZXR1cm4gZm9ybWF0cy5tYXAoZm9ybWF0ID0+IHtcblx0XHRjb25zdCBmb3JtYXRGaWxlcyA9IGZpbGVzLmZpbHRlcihmaWxlID0+IGZpbGUudHlwZSA9PT0gZm9ybWF0LnR5cGUpO1xuXHRcdGNvbnN0IGNvbmNlcm5zID0gZm9ybWF0RmlsZXMubWFwKGZpbGUgPT4gZmlsZS5jb25jZXJuKTtcblxuXHRcdGNvbnN0IGhhc0RlbW8gPSBjb25jZXJucy5pbmNsdWRlcygnZGVtbycpO1xuXHRcdGNvbnN0IGRlZmF1bHRDb25jZXJuID0gaGFzRGVtbyA/ICdkZW1vJyA6ICdpbmRleCc7XG5cdFx0Y29uc3QgcGFyc2VkID0gdXJsUXVlcnkucGFyc2Uoc3RhdGUuc291cmNlSWQgfHwgJycpO1xuXG5cdFx0Y29uc3QgcGFzc2VkQ29uY2VybiA9IHBhdGguYmFzZW5hbWUocGFyc2VkLnBhdGhuYW1lLCBwYXRoLmV4dG5hbWUocGFyc2VkLnBhdGhuYW1lKSkgfHxcblx0XHRcdGRlZmF1bHRDb25jZXJuO1xuXG5cdFx0Y29uc3QgaXNBcHBsaWNhYmxlID0gY29uY2VybnMuaW5jbHVkZXMocGFzc2VkQ29uY2Vybik7XG5cblx0XHRjb25zdCBjb25jZXJuID0gaXNBcHBsaWNhYmxlID9cblx0XHRcdHBhc3NlZENvbmNlcm4gOlxuXHRcdFx0ZGVmYXVsdENvbmNlcm47XG5cblx0XHRjb25zdCBzb3VyY2VUeXBlID0gZm9ybWF0LnR5cGUgPT09ICdkb2N1bWVudGF0aW9uJyA/ICdzb3VyY2UnIDogc3RhdGUuc291cmNlVHlwZTtcblx0XHRjb25zdCBsYW5ndWFnZSA9IHNvdXJjZVR5cGUgPT09ICdzb3VyY2UnID8gZm9ybWF0LmluIDogZm9ybWF0Lm91dDtcblx0XHRjb25zdCBleHRuYW1lID0gZm9ybWF0LmluRXh0bmFtZTtcblx0XHRjb25zdCBwYXRobmFtZSA9IFtwYXR0ZXJuLmlkLCBgJHtjb25jZXJufSR7ZXh0bmFtZX1gXS5qb2luKCcvJyk7XG5cdFx0Y29uc3QgdHlwZXMgPSBoYXNEZW1vICYmIGNvbmNlcm4gPT09ICdpbmRleCcgPyBbJ3NvdXJjZSddIDogWydzb3VyY2UnLCAndHJhbnNmb3JtZWQnXTtcblx0XHRjb25zdCB0eXBlID0gaGFzRGVtbyAmJiBjb25jZXJuID09PSAnaW5kZXgnID8gJ3NvdXJjZScgOiBzb3VyY2VUeXBlO1xuXG5cdFx0Y29uc3QgaWQgPSB1cmxRdWVyeS5mb3JtYXQoe1xuXHRcdFx0cGF0aG5hbWUsXG5cdFx0XHRxdWVyeToge1xuXHRcdFx0XHR0eXBlLFxuXHRcdFx0XHRlbnZpcm9ubWVudDogc3RhdGUuZW52aXJvbm1lbnRcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGNvbnN0IHNvdXJjZSA9IHNvdXJjZXNbaWRdO1xuXHRcdGNvbnN0IGFjdGl2ZSA9IHN0YXRlLnNvdXJjZUlkID09PSBpZDtcblxuXHRcdGNvbnN0IGZpbGVFcnJvcnMgPSBlcnJvcnMuZmlsdGVyKGVycm9yID0+IHtcblx0XHRcdHJldHVybiBlcnJvci5wYXlsb2FkID9cblx0XHRcdFx0ZXJyb3IucGF5bG9hZC5pZCA9PT0gaWQgOlxuXHRcdFx0XHRlcnJvci5wYXR0ZXJuRmlsZSA9PT0gaWQ7XG5cdFx0fSk7XG5cblx0XHRjb25zdCB1cGRhdGUgPSBhY3RpdmUgJiZcblx0XHRcdCFzb3VyY2UgJiZcblx0XHRcdCFwYXR0ZXJuLnNvdXJjZUxvYWRpbmcgJiZcblx0XHRcdCFmaWxlRXJyb3JzLmxlbmd0aDtcblxuXHRcdHJldHVybiB7XG5cdFx0XHRhY3RpdmUsXG5cdFx0XHR1cGRhdGUsXG5cdFx0XHRleHRuYW1lLFxuXHRcdFx0Y29uY2Vybixcblx0XHRcdGNvbmNlcm5zLFxuXHRcdFx0aWQsXG5cdFx0XHRzaG9ydGlkOiBzaG9ydGlkKGlkKSxcblx0XHRcdGxhbmd1YWdlLFxuXHRcdFx0bmFtZTogZm9ybWF0LmRpc3BsYXlOYW1lLFxuXHRcdFx0c291cmNlOiBzb3VyY2UgfHwgJycsXG5cdFx0XHR0eXBlLFxuXHRcdFx0dHlwZXNcblx0XHR9O1xuXHR9KTtcbn1cbiJdfQ==